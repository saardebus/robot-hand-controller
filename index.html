
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot Hand Control</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="video-panel">
            <div class="video-container">
                <video id="webcam" autoplay playsinline></video>
                <canvas id="output-canvas"></canvas>
                <div id="no-hand-message" class="overlay-message">No hand detected</div>
            </div>
            <div class="video-controls">
                <label for="camera-select">Camera: </label>
                <select id="camera-select"></select>
            </div>
        </div>

        <div class="control-panel">
            <div class="connection-settings">
                <h2>Connection Settings</h2>
                <div class="input-group">
                    <label for="robot-ip">Robot Hand IP:</label>
                    <div class="ip-input-container">
                        <input type="text" id="robot-ip" placeholder="192.168.1.100">
                        <div id="connection-indicator"></div>
                    </div>
                </div>
                <div class="input-group">
                    <label for="min-change">Minimum Change to Update:</label>
                    <input type="number" id="min-change" min="0" max="100" value="2">
                </div>
                <div class="input-group">
                    <label for="send-interval">Send Interval (seconds):</label>
                    <input type="number" id="send-interval" min="0.1" max="10" step="0.1" value="0.5">
                </div>
                <div class="button-group">
                    <button id="start-tracking" class="primary-button">Start Tracking</button>
                    <button id="toggle-landmarks">Show Landmark IDs</button>
                </div>
            </div>

            <div class="servo-formulas">
                <h2>Servo Control Formulas</h2>
                <div class="formula-container">
                    <div class="formula-group" data-servo-id="0">
                        <label for="formula-0">Thumb Flexion/Extension (ID: 0):</label>
                        <input type="text" id="formula-0" class="formula-input" placeholder="Enter formula">
                    </div>
                    <div class="formula-group" data-servo-id="1">
                        <label for="formula-1">Thumb Lateral Movement (ID: 1):</label>
                        <input type="text" id="formula-1" class="formula-input" placeholder="Enter formula">
                    </div>
                    <div class="formula-group" data-servo-id="2">
                        <label for="formula-2">Index Finger Flexion/Extension (ID: 2):</label>
                        <input type="text" id="formula-2" class="formula-input" placeholder="Enter formula">
                    </div>
                    <div class="formula-group" data-servo-id="3">
                        <label for="formula-3">Index Finger Adduction (ID: 3):</label>
                        <input type="text" id="formula-3" class="formula-input" placeholder="Enter formula">
                    </div>
                    <div class="formula-group" data-servo-id="4">
                        <label for="formula-4">Middle Finger Flexion/Extension (ID: 4):</label>
                        <input type="text" id="formula-4" class="formula-input" placeholder="Enter formula">
                    </div>
                    <div class="formula-group" data-servo-id="5">
                        <label for="formula-5">Ring Finger Flexion/Extension (ID: 5):</label>
                        <input type="text" id="formula-5" class="formula-input" placeholder="Enter formula">
                    </div>
                    <div class="formula-group" data-servo-id="6">
                        <label for="formula-6">Ring Finger Adduction (ID: 6):</label>
                        <input type="text" id="formula-6" class="formula-input" placeholder="Enter formula">
                    </div>
                    <div class="formula-group" data-servo-id="7">
                        <label for="formula-7">Pinky Finger Flexion/Extension (ID: 7):</label>
                        <input type="text" id="formula-7" class="formula-input" placeholder="Enter formula">
                    </div>
                    <div class="formula-group" data-servo-id="8">
                        <label for="formula-8">Pinky Finger Adduction (ID: 8):</label>
                        <input type="text" id="formula-8" class="formula-input" placeholder="Enter formula">
                    </div>
                    <div class="formula-group" data-servo-id="9">
                        <label for="formula-9">Wrist Flexion/Extension (ID: 9):</label>
                        <input type="text" id="formula-9" class="formula-input" placeholder="Enter formula">
                    </div>
                    <div class="formula-group" data-servo-id="10">
                        <label for="formula-10">Forearm Pronation/Supination (ID: 10):</label>
                        <input type="text" id="formula-10" class="formula-input" placeholder="Enter formula">
                    </div>
                </div>
            </div>

            <div class="config-buttons">
                <button id="save-config">Save Configuration</button>
                <button id="load-config">Load Configuration</button>
                <input type="file" id="config-file-input" accept=".json" style="display: none;">
            </div>

            <div class="status-panel">
                <h2>Status</h2>
                <div id="status-messages" class="status-messages"></div>
                <div class="performance-info">
                    <span>FPS: <span id="fps-counter">0</span></span>
                </div>
            </div>

            <div class="servo-values">
                <h2>Servo Values</h2>
                <div class="servo-tables">
                    <div class="calculated-values">
                        <h3>Calculated Values</h3>
                        <table id="calculated-values-table">
                            <thead>
                                <tr>
                                    <th>Servo ID</th>
                                    <th>Name</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <div class="sent-values">
                        <h3>Last Sent Values</h3>
                        <table id="sent-values-table">
                            <thead>
                                <tr>
                                    <th>Servo ID</th>
                                    <th>Name</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="robot-status">
                <h2>Robot Hand Status</h2>
                <table id="robot-status-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Position</th>
                            <th>Temp</th>
                            <th>Load</th>
                            <th>Min</th>
                            <th>Max</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Load TensorFlow.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.19.0/dist/tf.min.js"></script>
    
    <!-- Load the TensorFlow.js HandPose model from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose@0.0.7/dist/handpose.min.js"></script>
    
    <!-- Load the TensorFlow.js HandPose model -->
    <script>
        // Create a global variable to store the model
        let handposeModel;
        
        // Load the HandPose model
        async function loadHandposeModel() {
            try {
                console.log('Loading TensorFlow.js HandPose model...');
                // Load the model
                handposeModel = await handpose.load();
                console.log('HandPose model loaded successfully!');
                return handposeModel;
            } catch (error) {
                console.error('Error loading HandPose model:', error);
                throw error;
            }
        }
    </script>

    <!-- Application JavaScript -->
    <script src="js/config.js"></script>
    <script src="js/formula-parser.js"></script>
    <script src="js/hand-tracking.js"></script>
    <script src="js/servo-control.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
</body>
</html>

